---
title: 'Linux ç£ç›˜ç®¡ç†ä¹‹ LVM åŸç†ä¸æ“ä½œ'
slug: 'linux-lvm'
type: posts
tags: ["DevOps"]
date: '2019-07-19'
lastmod: '2023-04-28'
author: æ²ˆç»´ç‡•
published: true
---

> ğŸ“¢ æœ¬æ–‡ç« åŒæ­¥è‡ªä½œè€…çš„[è¯­é›€çŸ¥è¯†åº“](https://www.yuque.com/shenweiyan/)ï¼Œè¯·ç‚¹å‡»[è¿™é‡Œ](https://www.yuque.com/shenweiyan/cookbook/linux-lvm)é˜…è¯»åŸæ–‡ã€‚

LVMÂ ï¼ˆ **L**ogicalÂ **V** olumeÂ **M**anager,Â é€»è¾‘å·ç®¡ç†å™¨ï¼‰Â æ˜¯Â LinuxÂ ç¯å¢ƒä¸‹å¯¹ç¡¬ç›˜åˆ†åŒºè¿›è¡Œç®¡ç†çš„ä¸€ç§æœºåˆ¶ï¼Œå¼€åˆ›è¿™é¡¹æŠ€æœ¯çš„åˆè¡·æ˜¯ä¸ºäº†è§£å†³ä¼ ç»Ÿç¡¬ç›˜åˆ†åŒºåˆ›å»ºåä¸æ˜“æ›´æ”¹å…¶å¤§å°çš„å¼±ç‚¹ã€‚å¯¹äºä¼ ç»Ÿç¡¬ç›˜åˆ†åŒºè¿›è¡Œå¼ºåˆ¶æ‰©å®¹å’Œç¼©å°æŠ€æœ¯ç†è®ºä¸Šè™½ç„¶æ˜¯å¯è¡Œçš„ï¼Œä½†å´æœ‰å¯èƒ½é€ æˆæ•°æ®çš„ä¸¢å¤±ï¼ŒLVMÂ é€»è¾‘å·ç®¡ç†å™¨æŠ€æœ¯èƒ½å¤Ÿå°†å¤šå—ç¡¬ç›˜è¿›è¡Œå·ç»„åˆå¹¶ï¼Œè®©ç”¨æˆ·ä¸å¿…å…³å¿ƒè®¾å¤‡åº•å±‚çš„æ¶æ„å’Œå¸ƒå±€ï¼Œæ‹¿æ¥å³ç”¨ã€‚

![](https://cdn.nlark.com/yuque/0/2019/jpeg/126032/1563516463579-cb8b7ed2-60f8-4f07-b91d-583ab1cf0bfe.jpeg#averageHue=%23afa658&height=360&id=rJKvs&originHeight=360&originWidth=640&originalType=binary&ratio=1&rotation=0&showTitle=false&size=0&status=done&style=none&title=&width=640)

LVMÂ é€»è¾‘å·ç®¡ç†å™¨æ˜¯åœ¨ç£ç›˜åˆ†åŒºå’Œæ–‡ä»¶ç³»ç»Ÿä¹‹é—´æ·»åŠ çš„é€»è¾‘å±‚ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªæŠ½è±¡çš„å·ç»„ï¼Œå¯ä»¥ä½¿å¾—å¤šå—ç¡¬ç›˜è¿›è¡Œå·ç»„åˆå¹¶ï¼Œè®©ç”¨æˆ·ä¸å¿…å…³å¿ƒç‰©ç†ç¡¬ç›˜è®¾å¤‡çš„åº•å±‚ç»“æ„ï¼Œä»è€Œå®ç°å¯¹åˆ†åŒºçš„çµæ´»åŠ¨æ€è°ƒæ•´ã€‚

> LVMÂ é€»è¾‘å·ç®¡ç†å™¨çš„æŠ€æœ¯ç»“æ„å¦‚å›¾ 2Â æ‰€ç¤ºï¼Œåˆ˜é„è€å¸ˆæ¥ä¸¾ä¸ªåƒè´§çš„ä¾‹å­å¸®åŠ©åŒå­¦ä»¬ç†è§£å§ï¼Œæ¯”å¦‚å®¶é‡Œæƒ³åƒé¦’å¤´ä½†é¢ç²‰ä¸å¤Ÿäº†ï¼Œå¦ˆå¦ˆåˆ†åˆ«ä»éš”å£è€ç‹å®¶ã€è€æå®¶ã€è€å¼ å®¶å€Ÿæ¥ä¸€äº›é¢ç²‰ï¼Œè’¸å‡ºé¦’å¤´åå¤§å®¶ä¸€èµ·æ¥åƒï¼Œé¦–å…ˆå’±ä»¬éœ€è¦å°†è¿™äº›é¢ç²‰ï¼ˆ**ç‰©ç†å·Â PV**ï¼ŒPhysicalÂ Volumeï¼‰åˆå¹¶æˆä¸€ä¸ªå¤§é¢å›¢ï¼ˆ**å·ç»„Â VG**ï¼ŒVolumeÂ Groupï¼‰ï¼Œç„¶åæŠŠè¿™ä¸€å¤§å›¢é¢å†åˆ†å‰²æˆä¸€ä¸ªä¸ªå°é¦’å¤´ï¼ˆ**é€»è¾‘å·Â LV**ï¼ŒLogicalÂ Volumeï¼‰ï¼Œæ¯ä¸ªå°é¦’å¤´çš„é‡é‡å¿…é¡»æ˜¯æ¯å‹ºé¢ç²‰ï¼ˆ**åŸºæœ¬å•å…ƒÂ PE**ï¼ŒPhysicalÂ Extentï¼‰çš„å€æ•°ã€‚ç‰©ç†å·æ˜¯å¤„äºé€»è¾‘å·ç®¡ç†å™¨ä¸­æœ€åº•å±‚çš„èµ„æºï¼Œå¯ä»¥ç†è§£æˆæ˜¯ç‰©ç†ç¡¬ç›˜ã€ç¡¬ç›˜åˆ†åŒºæˆ–è€…RAID ç£ç›˜é˜µåˆ—ç»„éƒ½å¯ä»¥ï¼Œè€Œå·ç»„æ˜¯å»ºç«‹åœ¨ç‰©ç†å·ä¹‹ä¸Šçš„ï¼Œä¸€ä¸ªå·ç»„ä¸­å¯ä»¥åŒ…å«å¤šä¸ªç‰©ç†å·ï¼Œå½“ç„¶åœ¨å·ç»„åˆ›å»ºä¹‹åä¹Ÿå¯ä»¥ç»§ç»­å‘å…¶ä¸­æ·»åŠ æ–°çš„ç‰©ç†å·ï¼Œè€Œé€»è¾‘å·æ˜¯å»ºç«‹äºå·ç»„ä¹‹ä¸Šçš„ï¼Œå°†å·ç»„ä¸­ç©ºé—²çš„èµ„æºå»ºç«‹å‡ºæ–°çš„é€»è¾‘å·ï¼Œå¹¶ä¸”é€»è¾‘å·å»ºç«‹åå¯ä»¥åŠ¨æ€çš„æ‰©å±•æˆ–ç¼©å°ç©ºé—´ï¼Œè¿™ä¹Ÿå°±æ˜¯Â LVMÂ é€»è¾‘å·ç®¡ç†å™¨çš„æ ¸å¿ƒç†å¿µã€‚ï¼ˆ[ç¬¬7ç« Â ä½¿ç”¨RAIDä¸LVMç£ç›˜é˜µåˆ—æŠ€æœ¯](http://www.linuxprobe.com/chapter-07.html)ï¼‰
> 
> 
> ![](https://cdn.nlark.com/yuque/0/2019/png/126032/1563516463553-518b3ab0-cb47-4ae3-9b9f-fe2ac6b56a7f.png#averageHue=%23f6f2f0&height=155&id=tryOk&originHeight=155&originWidth=544&originalType=binary&ratio=1&rotation=0&showTitle=false&size=0&status=done&style=none&title=&width=544)

##### 
## å¸¸ç”¨å‘½ä»¤

éƒ¨ç½²Â LVMÂ é€»è¾‘å·ç®¡ç†å™¨éœ€è¦ä¾æ¬¡å¯¹å¯¹ç‰©ç†å·ã€å·ç»„å’Œé€»è¾‘å·çš„é€ä¸ªé…ç½®ï¼Œå¸¸è§çš„å‘½ä»¤åˆ†åˆ«åŒ…æ‹¬æœ‰ï¼š

| åŠŸèƒ½/å‘½ä»¤ | ç‰©ç†å·ç®¡ç† | å·ç»„ç®¡ç† | é€»è¾‘å·ç®¡ç† |
| --- | --- | --- | --- |
| æ‰«æ | pvscan | vgscan | lvscan |
| å»ºç«‹ | pvcreate | vgcreate | lvcreate |
| æ˜¾ç¤º | pvdisplay | vgdisplay | lvdisplay |
| åˆ é™¤ | pvremove | vgremove | lvremove |
| ç¼©å° |  | vgreduce | lvreduce |
| ç¼©å° |  | vgreduce | lvreduce |


## å®æˆ˜å±•ç¤º

é˜¿é‡Œäº‘Â ECSÂ æ‰©å……Â 4TÂ ç£ç›˜ï¼Œå¹¶æŒ‚è½½ã€‚

### ç‰©ç†ç¡¬ç›˜
**æ–°å¢ä¸¤ä¸ªç‰©ç†ç¡¬ç›˜Â vdbï¼ˆ2199.0Â GBï¼‰ï¼Œvdcï¼ˆ2199.0Â GBï¼‰ã€‚Â ä¸ºæ¥ä¸‹æ¥Â åšLVMÂ åšå‡†å¤‡ã€‚**
```bash
[root@iZ88qg9l425Z ~]# fdisk -l

Disk /dev/vda: 42.9 GB, 42949672960 bytes
255 heads, 63 sectors/track, 5221 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x00078f9c

   Device Boot      Start         End      Blocks   Id  System
/dev/vda1   *           1        5222    41940992   83  Linux

Disk /dev/vdb: 2199.0 GB, 2199023255552 bytes
16 heads, 63 sectors/track, 4260880 cylinders
Units = cylinders of 1008 * 512 = 516096 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x00000000


Disk /dev/vdc: 2199.0 GB, 2199023255552 bytes
16 heads, 63 sectors/track, 4260880 cylinders
Units = cylinders of 1008 * 512 = 516096 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x00000000
```

### ç¡¬ç›˜åˆ†åŒº
å¯¹æ·»åŠ çš„ç‰©ç†ç¡¬ç›˜è¿›è¡Œåˆ†åŒºï¼Œè¿™é‡Œå…ˆå¯¹ /dev/vdc è¿›è¡Œå¤„ç†ï¼Œå®Œæˆåå¯¹ /dev/vdb è¿›è¡ŒåŒæ ·çš„å¤„ç†ã€‚
```bash
[root@iZ88qg9l425Z ~]# fdisk /dev/vdc
Device contains neither a valid DOS partition table, nor Sun, SGI or OSF disklabel
Building a new DOS disklabel with disk identifier 0x4613ad5e.
Changes will remain in memory only, until you decide to write them.
After that, of course, the previous content won't be recoverable.

Warning: invalid flag 0x0000 of partition table 4 will be corrected by w(rite)

WARNING: The size of this disk is 2.2 TB (2199023255552 bytes).
DOS partition table format can not be used on drives for volumes
larger than (2199023255040 bytes) for 512-byte sectors. Use parted(1) and GUID 
partition table format (GPT).


WARNING: DOS-compatible mode is deprecated. It's strongly recommended to
         switch off the mode (command 'c') and change display units to
         sectors (command 'u').

Command (m for help): p

Disk /dev/vdc: 2199.0 GB, 2199023255552 bytes
16 heads, 63 sectors/track, 4260880 cylinders
Units = cylinders of 1008 * 512 = 516096 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x4613ad5e

   Device Boot      Start         End      Blocks   Id  System

Command (m for help): n     # åˆ›å»ºæ–°åˆ†åŒº
Command action
   e   extended      # e ä¸ºé€»è¾‘åˆ†åŒº
   p   primary partition (1-4)      # p ä¸ºä¸»åˆ†åŒº
Select (default p): p
Partition number (1-4): 1    # ç”±äºæ˜¯æ–°ç›˜æˆ‘ä»¬è¾“å…¥1æ¥åˆ†ç¬¬ä¸€ä¸ªä¸»åˆ†åŒºï¼Œå…±å¯ä»¥åˆ†4ä¸ªä¸»åˆ†åŒº
First sector (1-4260880, default 1):  # é€‰æ‹©è¯¥åˆ†åŒºçš„èµ·å§‹ç£ç›˜æ•°ï¼Œå¦‚æ— ç‰¹æ®Šéœ€æ±‚å¼ºçƒˆå»ºè®®é€‰æ‹©é»˜è®¤ï¼Œä¹Ÿå°±æ˜¯1æ¥åˆ†åŒºï¼ˆå¯ç›´æ¥æŒ‰å›è½¦ï¼‰
Using default value 1
Last cylinder, +cylinders or +size{K,M,G} (1-4260880, default 4260880):  # å®šä¹‰è¯¥åˆ†åŒºçš„å¤§å°ï¼Œå¦‚æœæŒ‰é»˜è®¤ï¼ˆæŒ‰å›è½¦ï¼‰å³æ˜¯ä½¿ç”¨å…¨éƒ¨å¯ç”¨å­˜å‚¨é¢ï¼Œå¦‚åˆ†ä¸€ä¸ª 1G çš„ç©ºé—´ï¼Œè¾“å…¥ +1024m
Using default value 4260880

Command (m for help): t   # æ”¹å˜åˆ†åŒºæ ‡è¯†ç¬¦
Selected partition 1
Hex code (type L to list codes): 8e       
Changed system type of partition 1 to 8e (Linux LVM)

Command (m for help): p

Disk /dev/vdc: 2199.0 GB, 2199023255552 bytes
16 heads, 63 sectors/track, 4260880 cylinders
Units = cylinders of 1008 * 512 = 516096 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x4613ad5e

   Device Boot      Start         End      Blocks   Id  System
/dev/vdc1               1     4260880  2147483488+  8e  Linux LVM

Command (m for help): w    # å†™å…¥åˆ†åŒº
The partition table has been altered!

Calling ioctl() to re-read partition table.
Syncing disks.
[root@iZ88qg9l425Z ~]#
```

### åˆ›å»º PV
åœ¨æ–°å»ºçš„åˆ†åŒºä¸Šåˆ›å»º PV ç‰©ç†å·ï¼Œè¿™é‡Œå…ˆå¯¹ /dev/vdc è¿›è¡Œå¤„ç†ï¼Œå®Œæˆåéœ€è¦å¯¹ /dev/vdb è¿›è¡ŒåŒæ ·çš„å¤„ç†ã€‚
```bash
[root@iZ88qg9l425Z ~]# pvcreate /dev/vdc1
  Physical volume "/dev/vdc1" successfully created
[root@iZ88qg9l425Z ~]# pvs
  PV         VG   Fmt  Attr PSize PFree
  /dev/vdc1       lvm2 a--  2.00t 2.00t
[root@iZ88qg9l425Z ~]# pvdisplay 
  "/dev/vdc1" is a new physical volume of "2.00 TiB"
  --- NEW Physical volume ---
  PV Name               /dev/vdc1
  VG Name               
  PV Size               2.00 TiB
  Allocatable           NO
  PE Size               0   
  Total PE              0
  Free PE               0
  Allocated PE          0
  PV UUID               83IQY3-Z7O0-kicK-xIbJ-ZmUW-AlOF-ENUAp6
   
[root@iZ88qg9l425Z ~]# fdisk -l

Disk /dev/vda: 42.9 GB, 42949672960 bytes
255 heads, 63 sectors/track, 5221 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x00078f9c

   Device Boot      Start         End      Blocks   Id  System
/dev/vda1   *           1        5222    41940992   83  Linux

Disk /dev/vdb: 2199.0 GB, 2199023255552 bytes
16 heads, 63 sectors/track, 4260880 cylinders
Units = cylinders of 1008 * 512 = 516096 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x00000000


Disk /dev/vdc: 2199.0 GB, 2199023255552 bytes
16 heads, 63 sectors/track, 4260880 cylinders
Units = cylinders of 1008 * 512 = 516096 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x4613ad5e

   Device Boot      Start         End      Blocks   Id  System
/dev/vdc1               1     4260880  2147483488+  8e  Linux LVM
```

**å¯¹ /dev/vdcã€/dev/vdb è¿›è¡ŒåŒæ ·çš„æ“ä½œï¼ˆç¡¬ç›˜åˆ†åŒºã€åˆ›å»º PVï¼‰åæŸ¥çœ‹å·²æœ‰çš„ç‰©ç†å·ã€‚**
```bash
[root@iZ88qg9l425Z ~]# pvdisplay 
  "/dev/vdb1" is a new physical volume of "2.00 TiB"
  --- NEW Physical volume ---
  PV Name               /dev/vdb1
  VG Name               
  PV Size               2.00 TiB
  Allocatable           NO
  PE Size               0   
  Total PE              0
  Free PE               0
  Allocated PE          0
  PV UUID               YMNnk1-sdi5-zyhj-coI5-hwBJ-Kofw-2BLE58
   
  "/dev/vdc1" is a new physical volume of "2.00 TiB"
  --- NEW Physical volume ---
  PV Name               /dev/vdc1
  VG Name               
  PV Size               2.00 TiB
  Allocatable           NO
  PE Size               0   
  Total PE              0
  Free PE               0
  Allocated PE          0
  PV UUID               83IQY3-Z7O0-kicK-xIbJ-ZmUW-AlOF-ENUAp6
```

### æŠŠ PV åŠ å…¥åˆ° VG
å°†æ‰€æœ‰çš„æ–°å»ºçš„ PV åŠ å…¥åä¸º vgdate çš„å·ç»„ (Volume Group) ä¸­ã€‚
```bash
[root@iZ88qg9l425Z ~]# vgcreate vgdata /dev/vdb1 /dev/vdc1
  Volume group "vgdata" successfully created
[root@iZ88qg9l425Z ~]# vgs
  VG     #PV #LV #SN Attr   VSize VFree
  vgdata   2   0   0 wz--n- 4.00t 4.00t
[root@iZ88qg9l425Z ~]# vgdisplay 
  --- Volume group ---
  VG Name               vgdata
  System ID             
  Format                lvm2
  Metadata Areas        2
  Metadata Sequence No  1
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                0
  Open LV               0
  Max PV                0
  Cur PV                2
  Act PV                2
  VG Size               4.00 TiB
  PE Size               4.00 MiB
  Total PE              1048574
  Alloc PE / Size       0 / 0   
  Free  PE / Size       1048574 / 4.00 TiB
  VG UUID               QafGYd-s0HW-6Wrx-pr6v-1fnR-mvpB-zrZ0md

```

### åˆ›å»º LV é€»è¾‘å·
åˆ›å»ºåä¸º lvdata çš„ LV é€»è¾‘å·ã€‚
```bash
[root@iZ88qg9l425Z ~]# lvcreate -l 1048574 -n lvdata vgdata
  Logical volume "lvdata" created
```
 
### æ ¼å¼åŒ–å¹¶æŒ‚è½½
å¯¹ LV é€»è¾‘å·è¿›è¡Œæ ¼å¼åŒ–ï¼Œç„¶åæŒ‚è½½ã€‚
```bash
[root@iZ88qg9l425Z ~]# mkfs.ext4 -c /dev/vgdata/lvdata   # å¯¹åˆ†åŒºä½¿ç”¨ ext4 æ ¼å¼åŒ–ï¼Œ-c å‚æ•°è¦å…ˆæ£€æµ‹ç£ç›˜åé“
mke2fs 1.41.12 (17-May-2010)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
268435456 inodes, 1073739776 blocks
53686988 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=4294967296
32768 block groups
32768 blocks per group, 32768 fragments per group
8192 inodes per group
Superblock backups stored on blocks: 
    32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 
    4096000, 7962624, 11239424, 20480000, 23887872, 71663616, 78675968, 
    102400000, 214990848, 512000000, 550731776, 644972544

Writing inode tables: done                            
Creating journal (32768 blocks): done
Writing superblocks and filesystem accounting information: done

This filesystem will be automatically checked every 32 mounts or
180 days, whichever comes first.  Use tune2fs -c or -i to override.
[root@iZ88qg9l425Z ~]# mkdir /disk1
[root@iZ88qg9l425Z ~]# mount /dev/vgdata/lvdata /disk1/
[root@iZ88qg9l425Z ~]# df -Th
Filesystem           Type   Size  Used Avail Use% Mounted on
/dev/vda1            ext4    40G  3.6G   34G  10% /
tmpfs                tmpfs  3.9G     0  3.9G   0% /dev/shm
/dev/mapper/vgdata-lvdata
                     ext4   4.0T  195M  3.8T   1% /disk1
[root@iZ88qg9l425Z ~]#
```


## å‚è€ƒèµ„æ–™

- ã€Š[Linux LVMç®€æ˜æ•™ç¨‹ã€‹](https://linux.cn/article-3218-1.html)- Linux ä¸­å›½ Â· å¼€æºç¤¾åŒº
- å‡Œæ¿€å†° -ã€Š[Linux LVMé€»è¾‘å·é…ç½®è¿‡ç¨‹è¯¦è§£ï¼ˆåˆ›å»ºï¼Œå¢åŠ ï¼Œå‡å°‘ï¼Œåˆ é™¤ï¼Œå¸è½½ï¼‰](https://blog.51cto.com/dreamfire/1084729)ã€‹- 51CTO
- [å­—è¯€è·³åŠ¨](https://www.zhihu.com/people/4k8k) - ã€Š[ä¸€ç¯‡çœ‹æ‡‚ï¼Linuxç£ç›˜çš„ç®¡ç†ï¼ˆåˆ†åŒºã€æ ¼å¼åŒ–ã€æŒ‚è½½ï¼‰ï¼ŒLVMé€»è¾‘å·ï¼ŒRAIDç£ç›˜é˜µåˆ—](https://zhuanlan.zhihu.com/p/296777898)ã€‹ - çŸ¥ä¹
